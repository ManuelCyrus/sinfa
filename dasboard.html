<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Dashboard — PDV Farmácia</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>

  <style>
    /* Small UI tweaks */
    .sidebar { transition: width .25s ease; }
    .sidebar-collapsed .sidebar { width: 72px !important; }
    .sidebar-collapsed .menu-label { display: none; }
    .sidebar-collapsed .menu-item { justify-content: center; }
    .card-ghost { background: linear-gradient(180deg, rgba(59,130,246,0.04), rgba(99,102,241,0.02)); }
    .table-scroll { max-height: 34vh; overflow:auto; }
  </style>
</head>
<body class="min-h-screen bg-gray-100 text-gray-800 font-sans">

  <!-- TOPBAR -->
  <header class="fixed top-0 left-0 right-0 z-40 bg-white border-b border-gray-200 shadow-sm">
    <div class="max-w-7xl mx-auto flex items-center justify-between gap-4 px-4 py-3">
      <div class="flex items-center gap-3">
        <button id="btnToggleSidebar" class="p-2 rounded hover:bg-gray-100">
          <i class="fas fa-bars text-gray-600"></i>
        </button>
        <div class="flex items-center gap-3">
          <i class="fas fa-store text-2xl text-blue-600"></i>
          <div>
            <div class="text-lg font-semibold">PDV — Farmácia</div>
            <div class="text-xs text-gray-500">Painel administrativo</div>
          </div>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <div class="hidden md:flex items-center bg-gray-50 border rounded px-2 py-1 gap-2">
          <i class="fas fa-search text-gray-400"></i>
          <input id="topSearch" class="bg-transparent focus:outline-none text-sm" placeholder="Pesquisar vendas, clientes, produtos..." />
        </div>

        <button id="btnNotif" class="relative p-2 rounded hover:bg-gray-50">
          <i class="fas fa-bell text-gray-600"></i>
          <span id="badgeNotif" class="absolute -top-1 -right-1 text-xs bg-red-500 text-white rounded-full px-1">3</span>
        </button>

        <div class="relative">
          <button id="userBtn" class="flex items-center gap-2 px-3 py-1 rounded hover:bg-gray-50">
            <i class="fas fa-user-circle text-2xl text-gray-600"></i>
            <div class="hidden sm:block text-sm text-left">
              <div class="font-medium">Amnuel Fulama</div>
              <div class="text-xs text-gray-500">Administrador</div>
            </div>
            <i class="fas fa-chevron-down text-gray-400 hidden sm:block"></i>
          </button>
          <div id="userMenu" class="hidden absolute right-0 mt-2 w-44 bg-white border rounded shadow z-50 overflow-hidden">
            <a class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50" href="#"><i class="fas fa-id-badge mr-2 text-gray-400"></i> Perfil</a>
            <a class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50" href="#"><i class="fas fa-cog mr-2 text-gray-400"></i> Definições</a>
            <div class="border-t"></div>
            <a id="logout" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50" href="#"><i class="fas fa-sign-out-alt mr-2"></i> Sair</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- LAYOUT -->
  <div class="pt-16 flex">
    <!-- SIDEBAR -->
    <nav id="sidebar" class="sidebar bg-white border-r border-gray-200 w-64 p-4 h-[calc(100vh-64px)] overflow-y-auto sticky top-16">
      <div class="mb-4 text-xs text-gray-400 uppercase font-semibold">Navegação</div>

      <ul class="space-y-1">
        <li class="menu-item flex items-center gap-3 p-2 rounded hover:bg-blue-50 cursor-pointer">
          <i class="fas fa-chart-pie text-gray-500 w-6 text-center"></i><span class="menu-label text-gray-800">Dashboard</span>
        </li>
        <li class="menu-item flex items-center gap-3 p-2 rounded hover:bg-blue-50 cursor-pointer">
          <i class="fas fa-cash-register text-gray-500 w-6 text-center"></i><span class="menu-label">PDV / Vendas</span>
        </li>
        <li class="menu-item flex items-center gap-3 p-2 rounded hover:bg-blue-50 cursor-pointer">
          <i class="fas fa-boxes text-gray-500 w-6 text-center"></i><span class="menu-label">Estoque</span>
        </li>
        <li class="menu-item flex items-center gap-3 p-2 rounded hover:bg-blue-50 cursor-pointer">
          <i class="fas fa-file-invoice-dollar text-gray-500 w-6 text-center"></i><span class="menu-label">Faturação</span>
        </li>
        <li class="menu-item flex items-center gap-3 p-2 rounded hover:bg-blue-50 cursor-pointer">
          <i class="fas fa-users text-gray-500 w-6 text-center"></i><span class="menu-label">Clientes</span>
        </li>
        <li class="menu-item flex items-center gap-3 p-2 rounded hover:bg-blue-50 cursor-pointer">
          <i class="fas fa-user-cog text-gray-500 w-6 text-center"></i><span class="menu-label">Configurações</span>
        </li>
      </ul>

      <div class="mt-6 text-xs text-gray-400 uppercase mb-2 font-semibold">Atalhos</div>
      <div class="grid grid-cols-2 gap-2">
        <button class="px-3 py-2 rounded bg-blue-50 text-blue-700 text-sm"><i class="fas fa-plus mr-2"></i> Nova</button>
        <button class="px-3 py-2 rounded bg-gray-50 text-gray-700 text-sm"><i class="fas fa-file-invoice mr-2"></i> Faturas</button>
        <button class="px-3 py-2 rounded bg-gray-50 text-gray-700 text-sm"><i class="fas fa-box mr-2"></i> Receber</button>
        <button class="px-3 py-2 rounded bg-gray-50 text-gray-700 text-sm"><i class="fas fa-chart-line mr-2"></i> Relat.</button>
      </div>

      <div class="mt-6 text-xs text-gray-400 uppercase mb-2 font-semibold">Sistema</div>
      <div class="text-xs text-gray-500">Versão: <strong>1.0.0</strong></div>
    </nav>

    <!-- CONTEÚDO -->
    <main class="flex-1 p-6 overflow-auto">
      <div class="max-w-7xl mx-auto space-y-6">

        <!-- KPI cards -->
        <section class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
          <div class="bg-white p-4 rounded-lg shadow-sm flex items-center justify-between">
            <div>
              <div class="text-xs text-gray-400">Faturamento (Mês)</div>
              <div id="kpiRevenue" class="text-2xl font-bold text-blue-600">R$ 0,00</div>
              <div class="text-xs text-gray-500">Meta: R$ 50.000</div>
            </div>
            <i class="fas fa-dollar-sign text-3xl text-green-500"></i>
          </div>

          <div class="bg-white p-4 rounded-lg shadow-sm flex items-center justify-between">
            <div>
              <div class="text-xs text-gray-400">Vendas (Hoje)</div>
              <div id="kpiSales" class="text-2xl font-bold text-indigo-600">0</div>
              <div class="text-xs text-gray-500">Transações</div>
            </div>
            <i class="fas fa-shopping-cart text-3xl text-indigo-600"></i>
          </div>

          <div class="bg-white p-4 rounded-lg shadow-sm flex items-center justify-between">
            <div>
              <div class="text-xs text-gray-400">Clientes Ativos</div>
              <div id="kpiClients" class="text-2xl font-bold text-gray-800">0</div>
              <div class="text-xs text-gray-500">Últimos 30 dias</div>
            </div>
            <i class="fas fa-users text-3xl text-gray-600"></i>
          </div>

          <div class="bg-white p-4 rounded-lg shadow-sm flex items-center justify-between">
            <div>
              <div class="text-xs text-gray-400">Estoque Crítico</div>
              <div id="kpiLowStock" class="text-2xl font-bold text-red-600">0</div>
              <div class="text-xs text-gray-500">Produtos abaixo do mínimo</div>
            </div>
            <i class="fas fa-exclamation-triangle text-3xl text-red-500"></i>
          </div>
        </section>

        <!-- Filters & Charts -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Left: filters + line chart -->
          <div class="lg:col-span-2 space-y-4">
            <div class="bg-white p-4 rounded-lg shadow-sm">
              <div class="flex items-center justify-between mb-3">
                <div class="font-semibold">Vendas</div>
                <div class="flex items-center gap-2">
                  <div class="text-xs text-gray-500">Período</div>
                  <select id="periodSelect" class="border px-2 py-1 rounded">
                    <option value="7">Últimos 7 dias</option>
                    <option value="28">Últimos 28 dias</option>
                    <option value="90">Últimos 90 dias</option>
                    <option value="365">Último ano</option>
                  </select>
                  <button id="exportCsv" class="text-xs bg-gray-50 px-3 py-1 rounded hover:bg-gray-100">Exportar CSV</button>
                </div>
              </div>

              <canvas id="chartSales" height="120"></canvas>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-sm">
              <div class="flex justify-between items-center mb-3">
                <div class="font-semibold">Últimas Vendas</div>
                <div class="text-xs text-gray-500">Listagem recente</div>
              </div>

              <div class="table-scroll">
                <table class="w-full text-sm">
                  <thead class="text-xs text-gray-500 bg-gray-50 sticky top-0">
                    <tr>
                      <th class="p-2 text-left">#Fatura</th>
                      <th class="p-2 text-left">Cliente</th>
                      <th class="p-2 text-center">Itens</th>
                      <th class="p-2 text-right">Total</th>
                      <th class="p-2 text-right">Pagamento</th>
                    </tr>
                  </thead>
                  <tbody id="tableSales"></tbody>
                </table>
              </div>

              <div class="mt-3 flex justify-between items-center">
                <div class="text-xs text-gray-500">Mostrando <span id="salesCount">0</span> vendas</div>
                <div class="flex items-center gap-2">
                  <button id="prevPage" class="px-2 py-1 border rounded text-sm">Anterior</button>
                  <button id="nextPage" class="px-2 py-1 border rounded text-sm">Próximo</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Right: doughnut + activity -->
          <aside class="space-y-4">
            <div class="bg-white p-4 rounded-lg shadow-sm">
              <div class="flex justify-between items-center mb-3">
                <div class="font-semibold">Vendas por Categoria</div>
                <div class="text-xs text-gray-500">Distribuição</div>
              </div>
              <canvas id="chartCategories" height="160"></canvas>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-sm">
              <div class="flex justify-between items-center mb-3">
                <div class="font-semibold">Atividades Recentes</div>
                <button id="clearActivities" class="text-xs text-gray-500 hover:text-gray-700">Limpar</button>
              </div>
              <ul id="activityList" class="space-y-2 text-sm text-gray-700 max-h-48 overflow-auto"></ul>
            </div>

            <div class="bg-white p-4 rounded-lg shadow-sm">
              <div class="font-semibold mb-2">Alertas</div>
              <div id="alerts" class="text-sm text-red-600"></div>
            </div>
          </aside>
        </section>

      </div>
    </main>
  </div>

  <!-- FOOTER -->
  <footer class="fixed bottom-0 left-0 right-0 bg-white border-t text-sm text-gray-500 p-3 flex justify-between px-6">
    <div>© 2025 PDV Farmácia — Sistema de Faturação</div>
    <div id="footerClock" class="text-xs"></div>
  </footer>

  <!-- SCRIPTS: dados dummy, charts, interatividade -->
  <script>
    /* ---------- UTIL ---------- */
    function money(v){ return 'R$ ' + v.toFixed(2).replace('.', ','); }
    function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

    /* ---------- DADOS DUMMY ---------- */
    const categories = ['Medicamentos','Higiene','Vitaminas','Outros'];
    const today = new Date();
    // gerar vendas dos últimos 365 dias
    const salesByDay = {};
    for(let i=0;i<365;i++){
      const d = new Date(today); d.setDate(today.getDate()-i);
      const key = d.toISOString().slice(0,10);
      salesByDay[key] = rand(2000,8000);
    }

    // gerar vendas recentes (lista)
    const salesList = [];
    for(let i=0;i<50;i++){
      const date = new Date(); date.setMinutes(date.getMinutes()-i*15);
      const total = rand(20,500);
      salesList.push({
        id: 'F'+(1000+i),
        client: ['Consumidor Final','João Silva','Farmácia X','Maria'][rand(0,3)],
        items: rand(1,6),
        total,
        payment: ['Dinheiro','TPA','Transferência'][rand(0,2)],
        date: date.toISOString()
      });
    }

    // estoque dummy
    const products = [
      { id:'P001', name:'Dipirona', stock: rand(0,30), min:5 },
      { id:'P002', name:'Paracetamol', stock: rand(0,30), min:8 },
      { id:'P003', name:'Ibuprofeno', stock: rand(0,30), min:4 },
      { id:'P004', name:'Vitamina C', stock: rand(0,30), min:6 },
      { id:'P005', name:'Omeprazol', stock: rand(0,30), min:3 }
    ];

    /* ---------- ELEMENTOS ---------- */
    const kpiRevenue = document.getElementById('kpiRevenue');
    const kpiSales = document.getElementById('kpiSales');
    const kpiClients = document.getElementById('kpiClients');
    const kpiLowStock = document.getElementById('kpiLowStock');
    const tableSales = document.getElementById('tableSales');
    const salesCountEl = document.getElementById('salesCount');
    const activityList = document.getElementById('activityList');
    const alertsEl = document.getElementById('alerts');

    /* ---------- CALCULA KPIs ---------- */
    function calculateKPIs(rangeDays=7){
      // revenue = sum last rangeDays
      let revenue=0, salesCount=0;
      for(let i=0;i<rangeDays;i++){
        const d = new Date(); d.setDate(today.getDate()-i);
        const key = d.toISOString().slice(0,10);
        revenue += (salesByDay[key] || 0);
        // simulate transactions
        salesCount += rand(5,25);
      }
      kpiRevenue.textContent = money(revenue/100); // scaled down
      kpiSales.textContent = salesCount;
      kpiClients.textContent = rand(20,200);
      // low stock
      const low = products.filter(p=>p.stock <= p.min).length;
      kpiLowStock.textContent = low;
      if(low>0){
        alertsEl.innerHTML = `<div class="text-red-600">Existem ${low} produtos em stock crítico. <a href="#" class="underline">Ver estoque</a></div>`;
      } else {
        alertsEl.innerHTML = `<div class="text-green-600">Sem alertas críticos.</div>`;
      }
    }

    /* ---------- CHARTS ---------- */
    const salesCtx = document.getElementById('chartSales').getContext('2d');
    const categoriesCtx = document.getElementById('chartCategories').getContext('2d');

    function getRangeData(days){
      const labels = [];
      const values = [];
      for(let i=days-1;i>=0;i--){
        const d = new Date(); d.setDate(today.getDate()-i);
        const k = d.toISOString().slice(0,10);
        labels.push(k);
        values.push((salesByDay[k]||0)/100); // scale down
      }
      return { labels, values };
    }

    const salesChart = new Chart(salesCtx, {
      type: 'line',
      data: { labels: [], datasets: [{
        label: 'Vendas (R$)',
        data: [],
        borderColor: '#3b82f6',
        backgroundColor: 'rgba(59,130,246,0.08)',
        tension: 0.25,
        fill: true,
        pointRadius: 3
      }]},
      options: {
        responsive: true,
        plugins:{ legend:{ display:false } },
        scales: { y:{ beginAtZero:true } }
      }
    });

    const categoriesChart = new Chart(categoriesCtx, {
      type: 'doughnut',
      data: { labels: categories, datasets:[{
        data: [rand(10,40), rand(10,40), rand(5,30), rand(1,20)],
        backgroundColor: ['#60A5FA','#34D399','#F59E0B','#A78BFA']
      }]},
      options: { responsive:true, plugins:{ legend:{ position:'bottom' } } }
    });

    function updateCharts(days){
      const range = getRangeData(days);
      salesChart.data.labels = range.labels;
      salesChart.data.datasets[0].data = range.values;
      salesChart.update();
      // update categories randomly (simulate)
      categoriesChart.data.datasets[0].data = [rand(10,40), rand(10,40), rand(5,30), rand(1,20)];
      categoriesChart.update();
    }

    /* ---------- TABELA DE VENDAS (paginação simples) ---------- */
    let page = 0, perPage = 8;
    function renderTable(){
      tableSales.innerHTML = '';
      const start = page*perPage;
      const subset = salesList.slice(start, start+perPage);
      subset.forEach(s=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-2 text-sm">${s.id}</td>
          <td class="p-2 text-sm">${s.client}</td>
          <td class="p-2 text-center text-sm">${s.items}</td>
          <td class="p-2 text-right font-medium">${money(s.total)}</td>
          <td class="p-2 text-right text-xs text-gray-500">${s.payment}</td>
        `;
        tableSales.appendChild(tr);
      });
      salesCountEl.textContent = salesList.length;
    }

    document.getElementById('prevPage').addEventListener('click', ()=>{ if(page>0){ page--; renderTable(); }});
    document.getElementById('nextPage').addEventListener('click', ()=>{ if((page+1)*perPage<salesList.length){ page++; renderTable(); }});

    /* ---------- ATIVIDADES ---------- */
    function renderActivities(){
      activityList.innerHTML = '';
      const acts = [];
      for(let i=0;i<15;i++){
        acts.push({ t: `${rand(1,59)}m`, msg: ['Venda realizada','Estoque atualizado','Novo cliente cadastrado','Pagamento recebido'][rand(0,3)] });
      }
      acts.forEach(a=>{
        const li = document.createElement('li');
        li.className = 'flex justify-between';
        li.innerHTML = `<span>${a.msg}</span><span class="text-xs text-gray-400">${a.t} atrás</span>`;
        activityList.appendChild(li);
      });
    }
    document.getElementById('clearActivities').addEventListener('click', ()=> activityList.innerHTML='');

    /* ---------- EXPORT CSV (simples) ---------- */
    document.getElementById('exportCsv').addEventListener('click', ()=>{
      // export subset of salesList as CSV
      const rows = [['ID','Cliente','Itens','Total','Pagamento','Data']];
      salesList.slice(0,50).forEach(s=> rows.push([s.id,s.client,s.items,s.total,s.payment,s.date]));
      const csv = rows.map(r=> r.map(cell=> `"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'vendas.csv'; a.click(); URL.revokeObjectURL(url);
    });

    /* ---------- INTERAÇÕES SIDEBAR / USER MENU / PERÍODO ---------- */
    const body = document.body;
    document.getElementById('btnToggleSidebar').addEventListener('click', ()=>{
      body.classList.toggle('sidebar-collapsed');
    });
    const userBtn = document.getElementById('userBtn'), userMenu = document.getElementById('userMenu');
    userBtn.addEventListener('click', (e)=>{ e.stopPropagation(); userMenu.classList.toggle('hidden'); });
    document.addEventListener('click', ()=> userMenu.classList.add('hidden'));

    document.getElementById('periodSelect').addEventListener('change', (e)=>{
      const days = parseInt(e.target.value);
      calculateKPIs(days);
      updateCharts(days);
    });

    /* ---------- FOOTER CLOCK ---------- */
    function updateClock(){ document.getElementById('footerClock').textContent = new Date().toLocaleString('pt-BR'); }
    setInterval(updateClock,1000); updateClock();

    /* ---------- INICIALIZAÇÃO ---------- */
    calculateKPIs(7);
    updateCharts(7);
    renderTable();
    renderActivities();
  </script>
</body>
</html>
